### 跳跃表

+ **简要：**是一种有序数据结构，通过在每个节点中维持多个指向其他节点的指针，从而达到快速访问节点的目的。

  + **时间复杂度：**平均 `O(logN)`、最坏`O(N)`，另外还可以通过顺序性操作来批量处理节点。

+ `Redis`利用跳跃表作为`有序集合的底层实现之一`。

  ![image-20200914131137016](.\imges\image-20200914131137016.png)

+ 用途：实现有序集合键、集群节点中用作内部数据结构

### 二、跳跃表的实现

+ **介绍：**`Redis`的跳跃表由`redis.h/zskiplistNode`和`zskiplist`两个结构定义的，其中前者用于表示**跳跃表节点**，后者则用于保存**该节点的相关信息**，比如节点数量，以及指向表头节点和表尾节点的指针等等。
  ![image-20200914133133439](.\imges\image-20200914133133439.png)

  ![image-20200914133315968](.\imges\image-20200914133315968.png)

+ **跳跃表节点**

  + **定义**

    ​	![image-20200914135702825](.\imges\image-20200914135702825.png)

    + **层**
      	跳跃表节点的level数组可以包含多个元素，`每个元素都包含一个指向其他节点的指针`，加快速度，一般来说，`层数量越多，速度就越快`。
        	每次新建一个节点，根据`幂次定律`随机生成1-32之间的数作为level数组的大小(也就是高度)
      ![image-20200914140149677](.\imges\image-20200914140149677.png)
      ![image-20200914140239327](.\imges\image-20200914140239327.png)

    + **前进指针**

      ​	每个层都有一个指向表尾方向的`前进指针(level[i].foward属性)`，用于从表头向表尾方向访问节点。虚线表示`从表头向表尾方向，遍历跳跃表中所有节点的路径`
      ![image-20200914140724451](.\imges\image-20200914140724451.png)

    + **跨度**

      ​	层的跨度(`level[i].span属性`)用于记录`两个节点之间的距离`：跨度越大，则节点之间的距离就越远；指向NULL的所有前进指针的跨度都为0，因为没有连任何节点。

      ​	**注意：**很容易以为跨度和遍历操作有关，实际上 `遍历  只使用前进指针就可以完成`。但是` 跨度 是用来计算排位的`：在查找某个节点的过程中，将沿途访问过的所有层的`跨度累计起来`，得到结果就是`目标节点在跳跃表中的排位`。
      ![image-20200914142135854](.\imges\image-20200914142135854.png)
      ![image-20200914142247290](.\imges\image-20200914142247290.png)

      ![image-20200914142523867](.\imges\image-20200914142523867.png)

    + **后退指针**

      ​	节点的后退指针，用于从表向表头方向访问节点：跟一次逃过多个节点的前进指针是不同的，因为每个节点只有一个后退指针，只能后退到前一个节点。
      ![image-20200914143035464](.\imges\image-20200914143035464.png)
      ![image-20200914143119089](.\imges\image-20200914143119089.png)

    + **分值和成员**

      ​	节点的分值（score属性）是一个 `double 类型`的浮点数，跳跃表中的所有节点都按分值的	` 小到大进行排序`。

      ​	节点的成员 （obj属性）是一个指针，指向一个字符串对象，保存着一个`SDS`的值。该`obj对象必须是唯一的`，但是多个节点的分值可以是相同的，如果相同分值，那么按照成员对象在`字典序中的大小`进行排序，**成员对象较小的节点会排在前面**(靠近表头的方向)
      ![image-20200914143815876](.\imges\image-20200914143815876.png)

      

### 三、跳跃表API

![image-20200914144355311](.\imges\image-20200914144355311.png)

### 四、总结

![image-20200914144633341](.\imges\image-20200914144633341.png)